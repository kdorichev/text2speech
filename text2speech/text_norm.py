# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/01_text_norm.ipynb (unless otherwise specified).

__all__ = ['collapse_whitespace', 'lowercase', 'check_no_numbers', 'remove_specials', 'expand_abbreviations',
           'basic_cleaner', 'russian_cleaner']

# Cell
import re
from fastcore.test import *
from nbdev.showdoc import *

# Cell
_whitespace_re = re.compile(r'\s+')

def collapse_whitespace(text):
    "Replace multiple whitespaces with single space."
    return re.sub(_whitespace_re, ' ', text)

# Cell
def lowercase(text):
    return text.lower()

# Cell
def check_no_numbers(text):
    "Return a list of digits, or empty, if not found."
    return re.findall(r"(\d+)", text)

# Cell
_specials = [(re.compile(f'{x[0]}'), x[1]) for x in [
  ('!\.', '!'),
  ('\?\.', '?'),
  ('\/', ''),
  ('…', '.'),
  ('\.\.', '.')
]]

# Cell
def remove_specials(text):
    for regex, replacement in _specials:
        text = re.sub(regex, replacement, text)
    return text

# Cell
_abbreviations = [(re.compile(f'\\b{x[0]}', re.IGNORECASE), x[1]) for x in [
  ('т.е.', 'то есть'),
  ('т.к.', 'так как'),
  ('и т.д.', 'и так далее'),
  ('и т.п.', 'и тому подобное')
]]

# Cell
def expand_abbreviations(text):
    for regex, replacement in _abbreviations:
        text = re.sub(regex, replacement, text)
    return text

# Cell
def basic_cleaner(text):
    "Basic pipeline that lowercases and collapses whitespaces."
    text = lowercase(text)
    text = collapse_whitespace(text)
    return text

# Cell
def russian_cleaner(text):
    """Pipeline for Russian text cleaning:
       lowercase, remove_specials, expand_abbreviations, collapse_whitespace, check_no_numbers."""
    text = lowercase(text)
    text = remove_specials(text)
    text = expand_abbreviations(text)
    text = collapse_whitespace(text)
    numbers = check_no_numbers(text)
    if (numbers != []):
        print("Запишите числительные не цифрами, а словами:")
        print(numbers)
    return text